-- üß† Login to MySQL
-- mysql -u root -p

-- ‚úÖ Step 1: Create Database
CREATE DATABASE IF NOT EXISTS CustomerDB;
USE CustomerDB;

-- üë§ Step 2: Create Customer Table
CREATE TABLE Customer (
    CustomerID INT PRIMARY KEY AUTO_INCREMENT,
    Name VARCHAR(100) NOT NULL,
    Address VARCHAR(200),
    Phone VARCHAR(15) UNIQUE NOT NULL,
    Email VARCHAR(100) UNIQUE NOT NULL
);

-- üí≥ Step 3: Create Account Table
CREATE TABLE Account (
    AccountID INT PRIMARY KEY AUTO_INCREMENT,
    CustomerID INT NOT NULL,
    AccountType VARCHAR(20) CHECK (AccountType IN ('Savings', 'Current', 'Fixed Deposit')),
    Balance DECIMAL(12,2) CHECK (Balance >= 0) DEFAULT 0.00,
    CreatedDate DATE DEFAULT (CURRENT_DATE),
    FOREIGN KEY (CustomerID) REFERENCES Customer(CustomerID)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

-- üíµ Step 4: Create Transaction Table
CREATE TABLE TransactionTable (
    TransactionID INT PRIMARY KEY AUTO_INCREMENT,
    AccountID INT NOT NULL,
    TransactionType VARCHAR(10) CHECK (TransactionType IN ('Credit', 'Debit')),
    Amount DECIMAL(12,2) CHECK (Amount > 0),
    TransactionDate DATE DEFAULT (CURRENT_DATE),
    FOREIGN KEY (AccountID) REFERENCES Account(AccountID)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

-- ‚úÖ Step 5: Verify table creation
SHOW TABLES;

DESCRIBE Customer;
DESCRIBE Account;
DESCRIBE TransactionTable;

-- ===========================================================
-- ‚ú® Step 6: Implement problem-specific requirements
-- ===========================================================

-- 1Ô∏è‚É£ Create a view to display customer name, account ID, and current balance
CREATE OR REPLACE VIEW CustomerAccountView AS
SELECT 
    c.Name AS CustomerName,
    a.AccountID,
    a.Balance AS CurrentBalance
FROM Customer c
JOIN Account a ON c.CustomerID = a.CustomerID;

-- 2Ô∏è‚É£ Create an index on TransactionDate in Transaction table
CREATE INDEX idx_transaction_date ON TransactionTable(TransactionDate);

-- ‚úÖ Step 7: Verify the view and index
SHOW FULL TABLES;
SHOW INDEXES FROM TransactionTable;

-- ‚úÖ Step 8: Test the view (optional)
-- SELECT * FROM CustomerAccountView;
